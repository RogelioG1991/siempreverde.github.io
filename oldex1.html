<script>
  // ✅ Config por "espacio" (TR1..TR20) con sus versiones
  // Edita los nombres de archivo a como los tengas en tu repo:
  // Ej: TR1.html, TR1_v2.html, TR1_v3.html (o TR1a.html, TR1b.html, etc.)
  const transmisionesConfig = [
    { id: "TR1",  opciones: ["TR1.html", "TR1_v2.html", "TR1_v3.html"] },
    { id: "TR2",  opciones: ["TR2.html"] },
    { id: "TR3",  opciones: ["TR3.html", "TR3_alt.html"] },
    { id: "TR4",  opciones: ["TR4.html"] },
    { id: "TR5",  opciones: ["TR5.html"] },
    { id: "TR6",  opciones: ["TR6.html"] },
    { id: "TR7",  opciones: ["TR7.html"] },
    { id: "TR8",  opciones: ["TR8.html"] },
    { id: "TR9",  opciones: ["TR9.html"] },
    { id: "TR10", opciones: ["TR10.html"] },
    { id: "TR11", opciones: ["TR11.html"] },
    { id: "TR12", opciones: ["TR12.html"] },
    { id: "TR13", opciones: ["TR13.html"] },
    { id: "TR14", opciones: ["TR14.html"] },
    { id: "TR15", opciones: ["TR15.html"] },
    { id: "TR16", opciones: ["TR16.html"] },
    { id: "TR17", opciones: ["TR17.html"] },
    { id: "TR18", opciones: ["TR18.html"] },
    { id: "TR19", opciones: ["TR19.html"] },
    { id: "TR20", opciones: ["TR20.html"] },
  ];

  const contenedor = document.getElementById("transmisiones");

  function cacheBust(url) {
    return url + (url.includes("?") ? "&" : "?") + "v=" + Date.now();
  }

  async function obtenerTituloDesdeArchivo(archivo, fallbackText) {
    try {
      const response = await fetch(cacheBust(archivo));
      const html = await response.text();
      const doc = new DOMParser().parseFromString(html, "text/html");
      const h2 = doc.querySelector(".container h2");
      return (h2 && h2.innerText.trim()) ? h2.innerText.trim() : fallbackText;
    } catch (e) {
      console.error("Error leyendo título de", archivo, e);
      return fallbackText;
    }
  }

  function labelOpcion(idx) {
    // Puedes cambiar esto a "Servidor 1", "Servidor 2", etc.
    return `Opción ${idx + 1}`;
  }

  async function render() {
    contenedor.innerHTML = "";

    for (const item of transmisionesConfig) {
      const { id, opciones } = item;

      // recordamos la última selección por TR
      const storageKey = `rg_${id}_sel`;
      const guardado = localStorage.getItem(storageKey);
      const seleccionadoInicial = (guardado && opciones.includes(guardado)) ? guardado : opciones[0];

      // fila
      const row = document.createElement("div");
      row.className = "transmision-item";

      // link
      const link = document.createElement("a");
      link.href = seleccionadoInicial;
      link.textContent = "Cargando...";
      row.appendChild(link);

      // selector
      const select = document.createElement("select");
      opciones.forEach((archivo, idx) => {
        const opt = document.createElement("option");
        opt.value = archivo;
        opt.textContent = labelOpcion(idx);
        if (archivo === seleccionadoInicial) opt.selected = true;
        select.appendChild(opt);
      });

      // si solo hay 1 opción, lo dejamos visible pero deshabilitado (igual hay menú)
      select.disabled = opciones.length <= 1;

      select.addEventListener("change", async () => {
        const elegido = select.value;
        localStorage.setItem(storageKey, elegido);
        link.href = elegido;

        // actualiza título según el HTML elegido
        link.textContent = await obtenerTituloDesdeArchivo(elegido, `${id}`);
      });

      row.appendChild(select);
      contenedor.appendChild(row);

      // carga inicial del título (según opción seleccionada)
      link.textContent = await obtenerTituloDesdeArchivo(seleccionadoInicial, `${id}`);
    }
  }

  render();
</script>
